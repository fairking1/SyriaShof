<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Syria Shof - Reset Password">
    <title>Reset Password - Syria Shof</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="auth-page" style="display: flex;">
        <div class="auth-container">
            <div class="logo-container">
                <div class="syria-flag">
                    <div class="flag-stripe flag-green"></div>
                    <div class="flag-stripe flag-white"></div>
                    <div class="flag-stripe flag-black"></div>
                    <div class="stars-container">
                        <span class="star">â˜…</span>
                        <span class="star">â˜…</span>
                        <span class="star">â˜…</span>
                    </div>
                </div>
                <div class="logo-text">Syria Shof</div>
            </div>

            <!-- Reset Password Form -->
            <div class="auth-form" id="resetPasswordForm">
                <div class="verification-icon">ğŸ”</div>
                <h2 class="auth-title" data-ar="ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©" data-en="Set New Password">ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <p class="verification-text" data-ar="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-en="Enter your new password">
                    Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                </p>
                <input type="password" class="auth-input" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-ar="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" data-en="New Password" autocomplete="new-password">
                <input type="password" class="auth-input" id="confirmPassword" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-ar="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-en="Confirm Password" autocomplete="new-password">
                <button class="auth-btn" id="resetPasswordBtn" data-ar="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-en="Reset Password">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                <p class="auth-switch">
                    <a href="/" data-ar="Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" data-en="Back to Login">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </p>
                <p class="error-msg" id="resetErrorMsg"></p>
                <p class="success-msg" id="resetSuccessMsg" style="display: none;"></p>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let currentLang = 'ar';

        // Get token from URL
        const urlParams = new URLSearchParams(window.location.search);
        const resetToken = urlParams.get('token');

        if (!resetToken) {
            document.getElementById('resetErrorMsg').textContent = 'Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­';
            document.getElementById('resetErrorMsg').style.display = 'block';
            document.getElementById('newPassword').disabled = true;
            document.getElementById('confirmPassword').disabled = true;
            document.getElementById('resetPasswordBtn').disabled = true;
        }

        document.getElementById('resetPasswordBtn').addEventListener('click', async () => {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorMsg = document.getElementById('resetErrorMsg');
            const successMsg = document.getElementById('resetSuccessMsg');

            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';

            if (!newPassword || !confirmPassword) {
                errorMsg.textContent = currentLang === 'ar' ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„' : 'Please fill all fields';
                errorMsg.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                errorMsg.textContent = currentLang === 'ar' ? 'ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©' : 'Passwords do not match';
                errorMsg.style.display = 'block';
                return;
            }

            if (newPassword.length < 6) {
                errorMsg.textContent = currentLang === 'ar' ? 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„' : 'Password must be at least 6 characters';
                errorMsg.style.display = 'block';
                return;
            }

            try {
                const response = await fetch('//api/auth', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'reset-password',
                        token: resetToken,
                        newPassword: newPassword
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    successMsg.textContent = currentLang === 'ar' ? 'âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...' : 'âœ… Password reset successfully! Redirecting...';
                    successMsg.style.display = 'block';
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    errorMsg.textContent = data.error || (currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' : 'Error resetting password');
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                errorMsg.textContent = currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…' : 'Server connection error';
                errorMsg.style.display = 'block';
            }
        });

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>

